{{#layout}}

  {{!-- Shared Parameters --}}

  {{parameter 'name_tag' logicalId="NameTag"}}


  {{!-- VPC --}}

  {{parameter 'vpc_cidr' logicalId="VpcCidr"}}

  {{#resource logicalId="Vpc"}}
    "Type": "AWS::EC2::VPC",
    "Properties": {
      "CidrBlock": {
        "Ref": "VpcCidr"
      },
      "InstanceTenancy": "default",
      "EnableDnsSupport": "true",
      "EnableDnsHostnames": "true",
      "Tags": [{"Key": "Name", "Value": {"Ref": "NameTag" } }]
    }
  {{/resource}}

  {{#output logicalId="VpcId"}}
    "Value": { "Ref": "Vpc" }
  {{/output}}

  {{#output logicalId="DefaultSecurityGroupId"}}
    "Value": {"Fn::GetAtt": ["Vpc","DefaultSecurityGroup"]}
  {{/output}}

  {{#output logicalId="DefaultNetworkAcl"}}
    "Value": {"Fn::GetAtt": ["Vpc","DefaultNetworkAcl"]}
  {{/output}}


  {{!-- Internet Gateway --}}

  {{set 'simple/create_internet_gateway' parameterLogicalId="CreateInternetGateway"}}

  {{#resource "internet_gateway"
    logicalId="InternetGateway"
    condition="CreateInternetGatewayIsTrueCondition"
  }}
    "Properties": {
      "Tags": [{"Key": "Name", "Value": {"Ref": "NameTag"} }]
    }
  {{/resource}}

  {{#resource logicalId="GatewayAttachment"}}
    "Type": "AWS::EC2::VPCGatewayAttachment",
    "Condition": "CreateInternetGatewayIsTrueCondition",
    "Properties": {
      "VpcId": {
        "Ref": "Vpc"
      },
      "InternetGatewayId": {
        "Ref": "InternetGateway"
      }
    }
  {{/resource}}

  {{#resource logicalId="PublicRouteTable"}}
    "Type": "AWS::EC2::RouteTable",
    "Properties": {
      "VpcId": {"Ref": "Vpc"},
      "Tags": [
        {"Key": "Name", "Value": {"Ref": "NameTag"} },
        {"Key": "Network", "Value": "Public"}
      ]
    }
  {{/resource}}

  {{#resource logicalId="PublicRoute"}}
    "Type": "AWS::EC2::Route",
    "Condition": "CreateInternetGatewayIsTrueCondition",
    "Properties": {
      "DestinationCidrBlock": "0.0.0.0/0",
      "RouteTableId": {"Ref": "PublicRouteTable"},
      "GatewayId": {"Ref": "InternetGateway"}
    }
  {{/resource}}

  {{#output logicalId="PublicRouteTableId"}}
    "Value": {"Ref": "PublicRouteTable"}
  {{/output}}


{{/layout}}
