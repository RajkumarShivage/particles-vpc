{{!-- Subnet --}}
{{parameter "m:core" "cidr_range" logicalId="SubnetCidr" default=defaultCidr}}

{{
  parameter "availability_zone"
  logicalId="AvailabilityZone"
  default=defaultAvailabilityZone
  description="Valid availability zone for the region.  Leave blank to have AWS automatically assign."
  optional=true
}}

{{set "m:core" "empty_conditions" parameterLogicalId=(scopeId "AvailabilityZone")}}

{{#
  resource "subnet"
  logicalId="Subnet"
  cidrBlock=(ref "SubnetCidr")
  vpcId=vpcId
}}
  "Properties": {
    "AvailabilityZone": {
      "Fn::If": [
        "{{concat (scopeId "AvailabilityZone") "IsPopulated"}}",
        {{ref "AvailabilityZone"}},
        {"Ref": "AWS::NoValue"}
      ]
    }
  }
{{/resource}}

{{set "subnet/all_outputs" subnetLogicalId=(scopeId "Subnet")}}


{{!-- Route Table --}}
{{!--  This is probably not needed for a simple subnet. Will be associated with the default route for the VPC on creation
{{parameter "route_table_id" logicalId="RouteTableId"}}

{{set "m:core" "empty_conditions" parameterLogicalId=(scopeId "RouteTableId")}}

{{
  resource "route_table_association"
  logicalId="RouteTableAssociation"
  routeTableId=(ref "RouteTableId")
  subnetId=(ref "Subnet")
  condition=(concat (scopeId "RouteTableId") "IsPopulated")
}}
--}}


